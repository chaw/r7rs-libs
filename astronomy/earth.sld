
(define-library
  (astronomy earth)
  (export
    earth-longitude-latitude-radius
    )
  (import (scheme base)
          (scheme cxr)
          (scheme inexact)
          (astronomy calendar)
          (srfi 1))

  (begin

    (define (earth-longitude-latitude-radius date)
      (let* ((tau (/ (- (julian-ephemeris-day date) 2451545)
                     365250))
             (ls (reverse
                   (fold 
                     (lambda (abc-list res-lst)
                       (cons
                         (fold
                           (lambda (abc res)
                             (+ res (* (car abc) 
                                       (cos (+ (cadr abc)
                                               (* (caddr abc) tau))))))
                           0
                           abc-list)
                         res-lst))
                     '()
                     *earth-abc*))))
        (/ (+ (list-ref ls 0) 
              (* (list-ref ls 1) tau)
              (* (list-ref ls 2) tau tau)
              (* (list-ref ls 3) tau tau tau)
              (* (list-ref ls 4) tau tau tau tau)
              (* (list-ref ls 5) tau tau tau tau tau))
           (expt 10 8))))

    (define *earth-abc*
      '(; L0
        (
         (175347046 0 0)
         (3341656 46692568/10000000 62830758500)
         (34894 46261/10000 125661517/10000)
         (3497 27441/10000 57533849/10000)
         (3418 28289/10000 35231/10000)
         (3136 36277/10000 777137715/10000)
         (2676 44181/10000 78604194/10000)
         (2343 61352/10000 39302097/10000)
         (1324 7425/10000 115067698/10000)
         (1273 20371/10000 529691/1000)
         (1199 11096/10000 15773435/10000)
         (990 5233/1000 5884927/1000)
         (902 2045/1000 26298/1000)
         (857 3508/1000 398149/1000)
         (780 1179/1000 5223694/1000)
         (753 2533/1000 5507553/1000)
         (505 4583/1000 18849228/1000)
         (492 4205/1000 775523/1000)
         (357 292/100 67/1000)
         (317 5849/1000 11790629/1000)
         (284 1899/1000 796298/1000)
         (271 315/1000 10977079/1000)
         (243 345/1000 5486778/1000)
         (206 4806/1000 2544314/1000)
         (205 1869/1000 5573143/1000)
         (202 2458/1000 6069777/1000)
         (156 833/1000 213299/1000)
         (132 3411/1000 2942463/1000)
         (126 1083/1000 20775/1000)
         (115 645/1000 98/100)
         (103 636/1000 4694003/1000)
         (102 976/1000 15720839/1000)
         (102 4267/1000 7114/1000)
         (99 621/100 214617/100)
         (98 68/100 15542/100)
         (86 598/100 16100069/100)
         (85 13/10 627596/100)
         (85 367/100 7143070/100)
         (80 181/100 1726015/100)
         (79 304/100 1203646/100)
         (75 176/100 508863/100)
         (74 35/10 315469/100)
         (74 468/100 80182/100)
         (70 83/100 943776/100)
         (62 398/100 882739/100)
         (61 182/100 70849/10)
         (57 278/100 628660/100)
         (56 439/100 1414350/100)
         (56 347/100 627955/100)
         (52 19/100 1213955/100)
         (52 133/100 174802/100)
         (51 28/100 585648/100)
         (49 49/100 119445/100)
         (41 537/100 842924/100)
         (41 24/10 1965105/100)
         (39 617/100 1044739/100)
         (37 604/100 1021329/100)
         (37 257/100 105938/100)
         (36 171/100 235287/100)
         (36 178/100 681277/100)
         (33 59/100 1778985/100)
         (30 44/100 8399685/100)
         (30 274/100 134987/100)
         (25 316/100 469048/100)
         )
        ; L1
        (
         (628331966747 0 0)
         (206059 2678235/1000000 6283075850/1000000)
         (4303 26351/10000 125661517/10000)
         (425 159/100 3523/1000)
         (119 5796/1000 26298/1000)
         (109 2966/1000 1577344/1000)
         (93 259/100 1884923/100)
         (72 114/100 52969/100)
         (68 187/100 39815/100)
         (67 441/100 550755/100)
         (59 289/100 522369/100)
         (56 217/100 15542/100)
         (45 4/10 79630/100)
         (36 47/100 77552/100)
         (29 265/100 711/100)
         (21 534/100 98/100)
         (19 185/100 548678/100)
         (19 497/100 21330/100)
         (17 299/100 627596/100)
         (16 3/100 254431/100)
         (16 143/100 214617/100)
         (15 121/100 1097708/100)
         (12 283/100 174802/100)
         (12 326/100 508863/100)
         (12 527/100 119445/100)
         (12 208/100 4694)
         (11 77/100 55357/100)
         (10 13/10 62866/10)
         (10 424/100 134987/100)
         (9 27/10 24273/100)
         (9 564/100 95172/100)
         (8 53/10 235287/100)
         (6 265/100 943776/100)
         (6 467/100 469048/100)
         )
        ; L2
        (
         (52919 0 0)
         (8720 10721/10000 62830758/10000)
         (309 867/1000 12566152/1000)
         (27 5/100 352/100)
         (16 519/100 2630/100)
         (10 76/100 1884923/100)
         (9 206/100 7771377/100)
         (7 83/100 77552/100)
         (5 466/100 157734/100)
         (4 103/100 711/100)
         (4 344/100 557314/100)
         (3 514/100 7963/10)
         (3 605/100 550755/100)
         (3 119/100 24273/100)
         (3 612/100 52969/100)
         (3 31/100 39815/100)
         (3 228/100 55357/100)
         (2 438/100 522369/100)
         (2 375/100 98/100)

         )
        ; L3
        (
         (289 5844/1000 6283076/1000)
         (35 0 0)
         (17 549/100 1256615/100)
         (3 52/10 15542/100)
         (1 472/100 352/100)
         (1 530/100 1884923/100)
         (1 597/100 24273/100)
         )
        ; L4
        (
         (114 3142/1000 0)
         (8 413/100 628308/100)
         (1 384/100 1256615/100)
         )
        ; L5
        (
         (1 314/100 0)
         )))


    ))

